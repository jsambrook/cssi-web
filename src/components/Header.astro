---
/*
 * Header.astro
 *
 * Sticky navigation header with logo and navigation links.
 * Height: 102px
 *
 * Props:
 *   navItems: Array of {label, href} objects
 *   ctaText: Text for CTA button (optional)
 *   ctaHref: Link for CTA button (optional)
 *   currentPath: Current page path for active nav highlighting
 */

import Logo from "./Logo.astro";

interface NavItem {
  label: string;
  href: string;
}

interface Props {
  navItems: NavItem[];
  ctaText?: string;
  ctaHref?: string;
  currentPath?: string;
}

const { navItems, ctaText, ctaHref, currentPath } = Astro.props;

function isActive(href: string): boolean {
  if (!currentPath) return false;
  if (href === "/") return currentPath === "/";
  return currentPath.startsWith(href);
}
---

<header class="sticky top-0 z-50 w-full bg-background shadow-sm">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex h-[102px] items-center justify-between">
      <!-- Logo -->
      <a href="/" class="flex items-center">
        <Logo />
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center gap-8">
        <nav class="flex items-center gap-8">
          {navItems.map((item, index) => (
            <a
              key={`nav-${index}`}
              href={item.href}
              class:list={[
                "font-medium transition-colors hover:text-primary",
                isActive(item.href) ? "text-primary" : "text-foreground/80",
              ]}
              aria-current={isActive(item.href) ? "page" : undefined}
            >
              {item.label}
            </a>
          ))}
        </nav>

        <!-- Dark Mode Toggle (Desktop) -->
        <button
          id="theme-toggle-desktop"
          type="button"
          aria-label="Switch to dark mode"
          class="inline-flex items-center justify-center rounded-button transition-all
                 hover:bg-accent/10 size-[42px] text-foreground/80 hover:text-primary"
        >
          <!-- Sun icon (shown in dark mode) -->
          <svg class="hidden dark:block h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
            <circle cx="12" cy="12" r="5" />
            <line x1="12" y1="1" x2="12" y2="3" />
            <line x1="12" y1="21" x2="12" y2="23" />
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
            <line x1="1" y1="12" x2="3" y2="12" />
            <line x1="21" y1="12" x2="23" y2="12" />
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
          </svg>
          <!-- Moon icon (shown in light mode) -->
          <svg class="block dark:hidden h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
          </svg>
        </button>

        {ctaText && ctaHref && (
          <a
            href={ctaHref}
            class="inline-flex items-center justify-center gap-2 whitespace-nowrap
                   rounded-button transition-all bg-primary text-primary-foreground
                   hover:bg-primary/90 shadow-sm h-[42px] px-6 py-2"
          >
            {ctaText}
          </a>
        )}
      </div>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-toggle"
        aria-label="Toggle menu"
        aria-expanded="false"
        aria-controls="mobile-menu"
        class="inline-flex items-center justify-center rounded-button transition-all
               hover:bg-accent/10 size-[54px] md:hidden"
      >
        <svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
          <line x1="4" x2="20" y1="12" y2="12"></line>
          <line x1="4" x2="20" y1="6" y2="6"></line>
          <line x1="4" x2="20" y1="18" y2="18"></line>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu (hidden by default) -->
  <div id="mobile-menu" class="hidden md:hidden border-t border-border/20">
    <div class="container mx-auto px-4 py-4 space-y-2">
      {navItems.map((item, index) => (
        <a
          key={`mobile-nav-${index}`}
          href={item.href}
          class:list={[
            "block py-2 font-medium hover:text-primary",
            isActive(item.href) ? "text-primary" : "text-foreground/80",
          ]}
          aria-current={isActive(item.href) ? "page" : undefined}
        >
          {item.label}
        </a>
      ))}

      <!-- Dark Mode Toggle (Mobile) -->
      <button
        id="theme-toggle-mobile"
        type="button"
        aria-label="Switch to dark mode"
        class="flex items-center gap-3 w-full py-2 font-medium text-foreground/80 hover:text-primary transition-colors"
      >
        <!-- Sun icon (shown in dark mode) -->
        <svg class="hidden dark:block h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
          <circle cx="12" cy="12" r="5" />
          <line x1="12" y1="1" x2="12" y2="3" />
          <line x1="12" y1="21" x2="12" y2="23" />
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
          <line x1="1" y1="12" x2="3" y2="12" />
          <line x1="21" y1="12" x2="23" y2="12" />
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
        </svg>
        <!-- Moon icon (shown in light mode) -->
        <svg class="block dark:hidden h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
        </svg>
        <span class="dark:hidden">Dark mode</span>
        <span class="hidden dark:inline">Light mode</span>
      </button>

      {ctaText && ctaHref && (
        <a
          href={ctaHref}
          class="block mt-4 text-center rounded-button bg-primary text-primary-foreground
                 py-3 px-6 hover:bg-primary/90"
        >
          {ctaText}
        </a>
      )}
    </div>
  </div>
</header>

<script>
  // Mobile menu toggle with focus management
  const toggle = document.getElementById('mobile-menu-toggle');
  const menu = document.getElementById('mobile-menu');
  const menuLinks = menu?.querySelectorAll('a');

  toggle?.addEventListener('click', () => {
    const menuIsNowHidden = menu?.classList.toggle('hidden');
    const menuIsNowOpen = !menuIsNowHidden;
    toggle.setAttribute('aria-expanded', String(menuIsNowOpen));

    if (menuIsNowOpen) {
      const firstLink = menu?.querySelector('a');
      firstLink?.focus();
    }
  });

  menuLinks?.forEach(link => {
    link.addEventListener('click', () => {
      menu?.classList.add('hidden');
      toggle?.setAttribute('aria-expanded', 'false');
      toggle?.focus();
    });
  });

  // Dark mode toggle
  function updateThemeLabels(isDark: boolean) {
    const label = isDark ? 'Switch to light mode' : 'Switch to dark mode';
    document.getElementById('theme-toggle-desktop')?.setAttribute('aria-label', label);
    document.getElementById('theme-toggle-mobile')?.setAttribute('aria-label', label);
  }

  function toggleTheme() {
    const isDark = document.documentElement.classList.toggle('dark');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
    updateThemeLabels(isDark);
  }

  // Set initial aria-labels based on current state
  updateThemeLabels(document.documentElement.classList.contains('dark'));

  document.getElementById('theme-toggle-desktop')?.addEventListener('click', toggleTheme);
  document.getElementById('theme-toggle-mobile')?.addEventListener('click', toggleTheme);
</script>
