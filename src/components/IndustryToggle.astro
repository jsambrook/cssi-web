---
/*
 * IndustryToggle.astro
 *
 * Segmented pill toggle (Healthcare | Tech) with 3 service cards.
 * Cards render both industry variants as data attributes; client-side JS
 * swaps title and description text on toggle click.
 *
 * Props:
 *   cards: ServiceCardItem[] — service cards with industry variants
 *   defaultIndustry: Industry — which variant to show initially
 */

import type { Industry, ServiceCardItem } from '../data/types';
import { colorClasses } from '@data/colors';

interface Props {
  cards: ServiceCardItem[];
  defaultIndustry: Industry;
}

const { cards, defaultIndustry } = Astro.props;

const categoryLabels: Record<string, string> = {
  'flow-dynamics': 'Flow Dynamics & Throughput',
  'market-offer': 'Market Offer Architecture',
  synchronization: 'Synchronization & Alignment',
};
---

<div class="industry-toggle" data-default-industry={defaultIndustry}>
  <!-- Segmented pill toggle -->
  <div class="flex justify-center mb-8">
    <div class="inline-flex rounded-full border-2 border-border bg-muted p-1 gap-1">
      <button
        type="button"
        class:list={[
          'toggle-btn rounded-full px-5 py-2 text-sm font-medium transition-all',
          defaultIndustry === 'healthcare'
            ? 'bg-primary text-primary-foreground shadow-sm'
            : 'text-muted-foreground hover:text-foreground',
        ]}
        data-industry="healthcare"
      >
        Healthcare
      </button>
      <button
        type="button"
        class:list={[
          'toggle-btn rounded-full px-5 py-2 text-sm font-medium transition-all',
          defaultIndustry === 'tech'
            ? 'bg-primary text-primary-foreground shadow-sm'
            : 'text-muted-foreground hover:text-foreground',
        ]}
        data-industry="tech"
      >
        Tech
      </button>
    </div>
  </div>

  <!-- Service cards grid -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-5xl mx-auto">
    {
      cards.map((card) => {
        const initial = card.variants[defaultIndustry];
        const color = card.color || 'default';
        return (
          <div
            class="service-card bg-card text-card-foreground flex flex-col gap-6 rounded-[var(--radius)]
                 border-2 border-border shadow-sm relative overflow-hidden
                 hover:shadow-xl transition-all duration-300 group"
            id={`service-${card.id}`}
            data-card-id={card.id}
            data-healthcare-title={card.variants.healthcare.title}
            data-healthcare-desc={card.variants.healthcare.description}
            data-tech-title={card.variants.tech.title}
            data-tech-desc={card.variants.tech.description}
          >
            <div class="absolute inset-0 bg-gradient-to-br from-accent/20 to-accent/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300" />

            <div class="p-6 space-y-4 relative">
              <div
                class:list={[
                  'inline-flex items-center justify-center w-14 h-14 rounded-xl',
                  colorClasses[color],
                ]}
              >
                <svg
                  class="h-7 w-7"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                >
                  <circle cx="12" cy="12" r="10" />
                  <circle cx="12" cy="12" r="6" />
                  <circle cx="12" cy="12" r="2" />
                </svg>
              </div>

              <p class="text-xs font-semibold uppercase tracking-wider text-muted-foreground">
                {categoryLabels[card.id] || card.id}
              </p>

              <div class="space-y-3">
                <h3 class="card-title text-xl">{initial.title}</h3>
                <p class="card-desc text-sm text-muted-foreground leading-relaxed">
                  {initial.description}
                </p>
              </div>
            </div>
          </div>
        );
      })
    }
  </div>
</div>

<script>
  document.querySelectorAll<HTMLElement>('.industry-toggle').forEach((container) => {
    const buttons = container.querySelectorAll<HTMLButtonElement>('.toggle-btn');
    const cards = container.querySelectorAll<HTMLElement>('.service-card');

    function switchIndustry(industry: string) {
      // Update button styles
      buttons.forEach((btn) => {
        const isActive = btn.dataset.industry === industry;
        btn.classList.toggle('bg-primary', isActive);
        btn.classList.toggle('text-primary-foreground', isActive);
        btn.classList.toggle('shadow-sm', isActive);
        btn.classList.toggle('text-muted-foreground', !isActive);
        btn.classList.toggle('hover:text-foreground', !isActive);
      });

      // Swap card content
      cards.forEach((card) => {
        const title = card.querySelector('.card-title') as HTMLElement;
        const desc = card.querySelector('.card-desc') as HTMLElement;
        title.textContent = card.dataset[`${industry}Title`] || '';
        desc.textContent = card.dataset[`${industry}Desc`] || '';
      });
    }

    buttons.forEach((btn) => {
      btn.addEventListener('click', () => {
        switchIndustry(btn.dataset.industry || 'healthcare');
      });
    });
  });
</script>
