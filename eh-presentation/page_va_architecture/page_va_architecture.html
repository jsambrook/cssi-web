<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI Voice Agents In Healthcare: Opportunities for EvergreenHealth - Common Sense Systems">
    <meta name="author" content="John Sambrook, Common Sense Systems, Inc.">
    <title>Voice Agent Architecture - AI Voice Agents for EvergreenHealth</title>
    
    <!-- Preconnect to external resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Embedded Styles for Safari file:// compatibility -->
    
    <!-- Favicon and icons -->
    <link rel="icon" type="image/svg+xml" href="../shared/assets/favicon.svg">
    <link rel="icon" type="image/png" href="../shared/assets/favicon.png">
    
    <!-- Open Graph meta tags -->
    <meta property="og:title" content="Voice Agent Architecture - AI Voice Agents for EvergreenHealth">
    <meta property="og:description" content="Unlocking Value with Voice Agents: Opportunities for EvergreenHealth">
    <meta property="og:type" content="website">
    <meta property="og:image" content="../shared/assets/og-image.png">
    
    <!-- Security headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">

    <!-- All styles embedded for Safari file:// compatibility -->
    <style>
        /* CSS Variables */
        :root {
            --eh-green: #006633;
            --eh-green-accent: #4CAF50;
            --eh-blue: #007BFF;
            --eh-blue-light: #E3F2FD;
            --eh-grey: #666666;
            --eh-red: #DC3545;
            --eh-white: #FFFFFF;
            --eh-green-dark: #004d26;
            --eh-green-light: #e8f5e8;
            --eh-blue-dark: #0056b3;
            --eh-grey-light: #f8f9fa;
            --eh-grey-dark: #333333;
            
            --font-family-primary: 'Lato', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;
            --font-size-4xl: 2.25rem;
            --font-size-5xl: 3rem;
            --font-size-6xl: 3.75rem;
            
            --font-weight-light: 300;
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 600;
            --font-weight-bold: 700;
            
            --line-height-tight: 1.25;
            --line-height-snug: 1.375;
            --line-height-normal: 1.5;
            --line-height-relaxed: 1.625;
            --line-height-loose: 2;
            
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --space-10: 2.5rem;
            --space-12: 3rem;
            --space-16: 4rem;
            --space-20: 5rem;
            --space-24: 6rem;
            
            --radius-sm: 0.125rem;
            --radius: 0.25rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
            --radius-xl: 0.75rem;
            --radius-2xl: 1rem;
            --radius-full: 9999px;
            
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            
            --transition-fast: 150ms ease;
            --transition-base: 250ms ease;
            --transition-slow: 350ms ease;
            
            --z-dropdown: 1000;
            --z-sticky: 1020;
            --z-fixed: 1030;
            --z-modal-backdrop: 1040;
            --z-modal: 1050;
            --z-popover: 1060;
            --z-tooltip: 1070;
            --z-toast: 1080;
            
            --page-max-width: 1200px;
            --page-padding: 1.5rem;
            --content-max-width: 800px;
            --navigation-height: 60px;
        }
        
        /* Reset */
        *, *::before, *::after {
            box-sizing: border-box;
        }
        
        * {
            margin: 0;
            padding: 0;
        }
        
        /* Base styles */
        html {
            font-size: 16px;
            scroll-behavior: smooth;
            height: 100%;
        }
        
        @supports (-webkit-touch-callout: none) {
            html {
                height: -webkit-fill-available;
            }
        }
        
        body {
            font-family: var(--font-family-primary);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-normal);
            line-height: var(--line-height-normal);
            color: var(--eh-grey-dark);
            background-color: var(--eh-white);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            height: 100%;
            min-height: 100vh;
            min-height: -webkit-fill-available;
        }
        
        /* Typography */
        h1, h2, h3, h4, h5, h6 {
            font-weight: var(--font-weight-bold);
            line-height: var(--line-height-tight);
            letter-spacing: -0.025em;
            margin-bottom: var(--space-4);
        }
        
        h1 {
            font-size: var(--font-size-4xl);
            color: var(--eh-green);
        }
        
        @media (min-width: 768px) {
            h1 {
                font-size: var(--font-size-5xl);
            }
        }
        
        @media (min-width: 1024px) {
            h1 {
                font-size: var(--font-size-6xl);
            }
        }
        
        /* Links */
        a {
            color: var(--eh-blue);
            text-decoration: none;
            transition: color var(--transition-fast);
        }
        
        a:hover {
            color: var(--eh-blue-dark);
            text-decoration: underline;
        }
        
        a:focus {
            outline: 2px solid var(--eh-blue);
            outline-offset: 2px;
        }
        
        /* Layout */
        .presentation-page {
            min-height: 100vh;
            min-height: -webkit-fill-available;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: var(--page-padding);
            padding-bottom: calc(var(--page-padding) + var(--navigation-height) + var(--space-4));
            position: relative;
            box-sizing: border-box;
        }
        
        .page-content {
            width: 100%;
            max-width: var(--content-max-width);
            text-align: center;
        }
        
        /* Logo */
        .logo {
            position: absolute;
            top: var(--space-6);
            left: var(--space-6);
            z-index: var(--z-sticky);
        }
        
        .logo img {
            height: 48px;
            width: auto;
            filter: drop-shadow(var(--shadow-sm));
        }
        
        @media (max-width: 768px) {
            .logo {
                top: var(--space-4);
                left: var(--space-4);
            }
            
            .logo img {
                height: 36px;
            }
        }
        
        /* Navigation */
        .navigation {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(0, 102, 51, 0.1);
            padding: var(--space-4);
            z-index: var(--z-fixed);
            box-sizing: border-box;
        }
        
        .nav-container {
            max-width: var(--page-max-width);
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-button {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-4);
            background: var(--eh-green);
            color: var(--eh-white);
            border: none;
            border-radius: var(--radius-md);
            font-family: var(--font-family-primary);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all var(--transition-fast);
            text-decoration: none;
        }
        
        .nav-button:hover {
            background: var(--eh-green-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
            color: var(--eh-white);
            text-decoration: none;
        }
        
        .nav-button:focus {
            outline: 2px solid var(--eh-blue);
            outline-offset: 2px;
        }
        
        .nav-button:disabled {
            background: var(--eh-grey-light);
            color: var(--eh-grey);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .progress-indicator {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            color: var(--eh-grey);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
        }
        
        .progress-bar {
            width: 120px;
            height: 4px;
            background: var(--eh-grey-light);
            border-radius: var(--radius-full);
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--eh-green);
            border-radius: var(--radius-full);
            transition: width var(--transition-base);
        }
        
        .icon {
            display: inline-block;
            width: 1em;
            height: 1em;
            fill: currentColor;
            vertical-align: middle;
        }
        
        
        /* Utility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        /* Page-specific styles */
        .architecture-title {
            font-size: var(--font-size-3xl);
            color: var(--eh-green);
            text-align: center;
            margin-bottom: var(--space-8);
            font-weight: var(--font-weight-bold);
        }
        
        .diagram-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto;
            max-width: 100%;
        }
        
        #architecture-diagram {
            width: 100%;
            max-width: 1200px;
            height: auto;
            border: 1px solid var(--eh-grey-light);
            border-radius: var(--radius-lg);
            background: var(--eh-white);
            box-shadow: var(--shadow-lg);
        }
        
        /* Tooltip Styles */
        .tooltip {
            position: absolute;
            background: var(--eh-grey-dark);
            color: var(--eh-white);
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
            font-family: var(--font-family-primary);
            pointer-events: none;
            z-index: var(--z-tooltip);
            display: none;
            max-width: 250px;
            line-height: var(--line-height-relaxed);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--eh-grey);
        }
        
        .tooltip::before {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--eh-grey-dark) transparent transparent transparent;
        }
        
        /* Responsive adjustments */
        @media (min-width: 768px) {
            .architecture-title {
                font-size: var(--font-size-4xl);
            }
        }
        
        @media (min-width: 1024px) {
            .architecture-title {
                font-size: var(--font-size-5xl);
            }
        }
        
        @media (max-width: 768px) {
            .architecture-title {
                font-size: var(--font-size-2xl);
                margin-bottom: var(--space-6);
            }
            
            .diagram-container {
                margin: var(--space-4) 0;
            }
            
            #architecture-diagram {
                max-width: calc(100vw - 2rem);
            }
            
            .presentation-page {
                padding-bottom: calc(1rem + 60px + 1.5rem);
            }
            
            .navigation {
                padding: var(--space-3);
            }
            
            .nav-container {
                gap: var(--space-2);
            }
            
            .nav-button {
                padding: var(--space-2) var(--space-3);
                font-size: var(--font-size-xs);
            }
            
            .progress-indicator {
                gap: var(--space-2);
            }
            
            .progress-bar {
                width: 80px;
            }
        }
        
        @supports (-webkit-touch-callout: none) {
            html {
                height: -webkit-fill-available;
            }
            
            .presentation-page {
                min-height: -webkit-fill-available;
            }
        }
        
        body {
            height: 100%;
            min-height: 100vh;
            min-height: -webkit-fill-available;
        }
        
        .presentation-page {
            min-height: 100vh;
            min-height: -webkit-fill-available;
            padding-bottom: calc(1.5rem + 60px + 1rem);
            box-sizing: border-box;
        }
        
        .navigation {
            -webkit-backdrop-filter: blur(10px);
        }
        
        .architecture-title {
            font-size: var(--font-size-3xl);
            color: var(--eh-green);
            text-align: center;
            margin-bottom: var(--space-8);
            font-weight: var(--font-weight-bold);
        }
        
        .diagram-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto;
            max-width: 100%;
        }
        
        #architecture-diagram {
            width: 100%;
            max-width: 1200px;
            height: auto;
            border: 1px solid var(--eh-grey-light);
            border-radius: var(--radius-lg);
            background: var(--eh-white);
            box-shadow: var(--shadow-lg);
        }
        
        /* Tooltip Styles */
        .tooltip {
            position: absolute;
            background: var(--eh-grey-dark);
            color: var(--eh-white);
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
            font-family: var(--font-family-primary);
            pointer-events: none;
            z-index: var(--z-tooltip);
            display: none;
            max-width: 250px;
            line-height: var(--line-height-relaxed);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--eh-grey);
        }
        
        .tooltip::before {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--eh-grey-dark) transparent transparent transparent;
        }
        
        /* Responsive adjustments */
        @media (min-width: 768px) {
            .architecture-title {
                font-size: var(--font-size-4xl);
            }
        }
        
        @media (min-width: 1024px) {
            .architecture-title {
                font-size: var(--font-size-5xl);
            }
        }
        
        @media (max-width: 768px) {
            .architecture-title {
                font-size: var(--font-size-2xl);
                margin-bottom: var(--space-6);
            }
            
            .diagram-container {
                margin: var(--space-4) 0;
            }
            
            #architecture-diagram {
                max-width: calc(100vw - 2rem);
            }
            
            .presentation-page {
                padding-bottom: calc(1rem + 60px + 1.5rem);
            }
        }
    </style>
</head>
<body>
    <!-- Skip navigation for accessibility -->
    <a href="#main-content" class="sr-only">Skip to main content</a>
    
    <!-- Company Logo -->
    <div class="logo">
        <a href="https://common-sense.com" target="_blank" rel="noopener noreferrer" aria-label="Visit Common Sense Systems website">
            <img src="../shared/assets/cssi_logo_symbol_1.png" alt="Common Sense Systems, Inc." width="48" height="48">
        </a>
    </div>
    
    <!-- Main Presentation Content -->
    <main id="main-content" class="presentation-page" role="main">
        <div class="page-content">
            <h1 class="architecture-title">AI Voice Agent Architecture</h1>
            
            <div class="diagram-container">
                <svg id="architecture-diagram" viewBox="0 0 1200 900" xmlns="http://www.w3.org/2000/svg">
                    <!-- Definitions for gradients, filters, and markers -->
                    <defs>
                        <!-- Gradient definitions -->
                        <linearGradient id="phoneGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#4a90e2"/>
                            <stop offset="100%" style="stop-color:#357abd"/>
                        </linearGradient>
                        
                        <linearGradient id="twilioGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#f22f46"/>
                            <stop offset="100%" style="stop-color:#c21e3a"/>
                        </linearGradient>
                        
                        <linearGradient id="elevenlabsGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#8b5cf6"/>
                            <stop offset="100%" style="stop-color:#7c3aed"/>
                        </linearGradient>
                        
                        <linearGradient id="systemPromptGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#7c2d92"/>
                            <stop offset="100%" style="stop-color:#5b1a6b"/>
                        </linearGradient>
                        
                        <linearGradient id="claudeGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#d97706"/>
                            <stop offset="100%" style="stop-color:#b45309"/>
                        </linearGradient>
                        
                        <linearGradient id="knowledgeGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#059669"/>
                            <stop offset="100%" style="stop-color:#047857"/>
                        </linearGradient>
                        
                        
                        <!-- Arrow markers -->
                        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
                        </marker>
                        
                        <marker id="arrowheadActive" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#4ade80"/>
                        </marker>
                        
                        <!-- Glow filter -->
                        <filter id="glow">
                            <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
                            <feMerge>
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                    </defs>
                    
                    <!-- Embedded styles -->
                    <style>
                        <![CDATA[
                        .component {
                            cursor: pointer;
                            transition: all 0.3s ease;
                            transform-origin: center;
                        }
                        
                        .component:hover {
                            filter: url(#glow);
                            transform: scale(1.05);
                        }
                        
                        .component-text {
                            font-family: Arial, sans-serif;
                            fill: white;
                            text-anchor: middle;
                            font-weight: bold;
                            pointer-events: none;
                        }
                        
                        .component-icon {
                            font-size: 24px;
                            text-anchor: middle;
                            pointer-events: none;
                        }
                        
                        .flow-line {
                            stroke: #666;
                            stroke-width: 2;
                            fill: none;
                            marker-end: url(#arrowhead);
                            transition: all 0.3s ease;
                        }
                        
                        .flow-line.active {
                            stroke: #4ade80;
                            stroke-width: 3;
                            filter: drop-shadow(0 0 5px #4ade80);
                            marker-end: url(#arrowheadActive);
                            stroke-dasharray: 8 4;
                            animation: flowAnimation 2s linear infinite;
                        }
                        
                        @keyframes flowAnimation {
                            from { stroke-dashoffset: 0; }
                            to { stroke-dashoffset: 12; }
                        }
                        
                        .flow-label {
                            font-family: Arial, sans-serif;
                            font-size: 12px;
                            fill: #1f2937;
                            text-anchor: middle;
                        }
                        ]]>
                    </style>
                    
                    
                    <!-- Components -->
                    <!-- User's Phone -->
                    <g id="phone" class="component">
                        <rect x="50" y="250" width="100" height="160" rx="20" fill="url(#phoneGradient)" stroke="#357abd" stroke-width="2"/>
                        <text x="100" y="290" class="component-icon">📱</text>
                        <text x="100" y="320" class="component-text" font-size="12">User's</text>
                        <text x="100" y="335" class="component-text" font-size="12">Phone</text>
                    </g>
                    
                    <!-- Twilio -->
                    <g id="twilio" class="component">
                        <rect x="250" y="280" width="120" height="100" rx="15" fill="url(#twilioGradient)" stroke="#c21e3a" stroke-width="2"/>
                        <text x="310" y="310" class="component-icon">☁️</text>
                        <text x="310" y="340" class="component-text" font-size="12">Twilio</text>
                        <text x="310" y="355" class="component-text" font-size="10">Voice API</text>
                    </g>
                    
                    <!-- ElevenLabs Voice Agent -->
                    <g id="elevenlabs" class="component">
                        <rect x="450" y="250" width="140" height="160" rx="15" fill="url(#elevenlabsGradient)" stroke="#7c3aed" stroke-width="2"/>
                        <text x="520" y="280" class="component-icon">🎙️</text>
                        <text x="520" y="305" class="component-text" font-size="12">ElevenLabs</text>
                        <text x="520" y="320" class="component-text" font-size="11">Voice Agent</text>
                        <text x="520" y="335" class="component-text" font-size="10">STT Processing</text>
                        <text x="520" y="350" class="component-text" font-size="10">Audio Handling</text>
                    </g>
                    
                    <!-- System Prompt -->
                    <g id="system-prompt" class="component">
                        <rect x="700" y="80" width="140" height="120" rx="15" fill="url(#systemPromptGradient)" stroke="#5b1a6b" stroke-width="2"/>
                        <text x="770" y="110" class="component-icon">📝</text>
                        <text x="770" y="135" class="component-text" font-size="12">System</text>
                        <text x="770" y="150" class="component-text" font-size="12">Prompt</text>
                        <text x="770" y="165" class="component-text" font-size="10">Instructions</text>
                        <text x="770" y="180" class="component-text" font-size="10">Personality</text>
                    </g>
                    
                    <!-- Claude 4 Sonnet -->
                    <g id="claude" class="component">
                        <rect x="700" y="250" width="140" height="160" rx="15" fill="url(#claudeGradient)" stroke="#b45309" stroke-width="2"/>
                        <text x="770" y="280" class="component-icon">🧠</text>
                        <text x="770" y="305" class="component-text" font-size="12">Claude 4</text>
                        <text x="770" y="320" class="component-text" font-size="12">Sonnet</text>
                        <text x="770" y="335" class="component-text" font-size="10">Language Model</text>
                        <text x="770" y="350" class="component-text" font-size="10">Reasoning Engine</text>
                    </g>
                    
                    <!-- Knowledge Base -->
                    <g id="knowledge-base" class="component">
                        <rect x="950" y="250" width="140" height="160" rx="15" fill="url(#knowledgeGradient)" stroke="#047857" stroke-width="2"/>
                        <text x="1020" y="280" class="component-icon">📚</text>
                        <text x="1020" y="305" class="component-text" font-size="12">Knowledge</text>
                        <text x="1020" y="320" class="component-text" font-size="12">Base</text>
                        <text x="1020" y="335" class="component-text" font-size="10">Vector Database</text>
                        <text x="1020" y="350" class="component-text" font-size="10">RAG System</text>
                    </g>
                    
                    
                    <!-- Flow Lines -->
                    <!-- flow0: System Prompt → Claude -->
                    <line id="flow0" class="flow-line" x1="770" y1="200" x2="770" y2="250"/>
                    <text x="785" y="225" class="flow-label">Configuration</text>
                    
                    <!-- flow1: Phone → Twilio -->
                    <line id="flow1" class="flow-line" x1="150" y1="330" x2="250" y2="330"/>
                    <text x="200" y="320" class="flow-label">Voice Call</text>
                    
                    <!-- flow2: Twilio → ElevenLabs -->
                    <line id="flow2" class="flow-line" x1="370" y1="330" x2="450" y2="330"/>
                    <text x="410" y="320" class="flow-label">Audio Stream</text>
                    
                    <!-- flow3: ElevenLabs → Claude -->
                    <line id="flow3" class="flow-line" x1="590" y1="320" x2="700" y2="320"/>
                    <text x="645" y="310" class="flow-label">Text Query</text>
                    
                    <!-- flow4: Claude → Knowledge Base -->
                    <line id="flow4" class="flow-line" x1="840" y1="320" x2="950" y2="320"/>
                    <text x="895" y="310" class="flow-label">RAG Query</text>
                    
                    <!-- flow5: Knowledge Base → Claude -->
                    <line id="flow5" class="flow-line" x1="950" y1="340" x2="840" y2="340"/>
                    <text x="895" y="355" class="flow-label">Context Data</text>
                    
                    <!-- flow6: Claude → ElevenLabs (text response) -->
                    <line id="flow6" class="flow-line" x1="700" y1="340" x2="590" y2="340"/>
                    <text x="645" y="355" class="flow-label">Response Text</text>
                    
                    <!-- flow7: ElevenLabs → Twilio -->
                    <line id="flow7" class="flow-line" x1="450" y1="340" x2="370" y2="340"/>
                    <text x="410" y="355" class="flow-label">Speech Output</text>
                    
                    <!-- flow8: Twilio → Phone -->
                    <line id="flow8" class="flow-line" x1="250" y1="340" x2="150" y2="340"/>
                    <text x="200" y="355" class="flow-label">Voice Response</text>
                </svg>
            </div>
            
            <!-- Tooltip element -->
            <div id="tooltip" class="tooltip"></div>
        </div>
    </main>
    
    <!-- Navigation Controls -->
    <nav class="navigation" role="navigation" aria-label="Presentation navigation">
        <div class="nav-container">
            <!-- Previous Page Button -->
            <a href="../page_challenges_and_trends/page_challenges_and_trends.html" class="nav-button nav-prev" aria-label="Previous page: Challenges and Trends">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="m15 18-6-6 6-6"/>
                </svg>
                Previous
            </a>
            
            <!-- Progress Indicator -->
            <div class="progress-indicator" role="progressbar" aria-valuenow="6" aria-valuemin="1" aria-valuemax="7">
                <span class="progress-text">Page 6 of 7</span>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 85.7%"></div>
                </div>
            </div>
            
            <!-- Next Page Button -->
            <a href="../page_references/page_references.html" class="nav-button nav-next" aria-label="Next page: References">
                Next
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="m9 18 6-6-6-6"/>
                </svg>
            </a>
        </div>
    </nav>
    
    
    <!-- Shared JavaScript -->
    <script src="../shared/js/navigation.js"></script>
    
    <!-- Page-specific JavaScript for diagram interactivity -->
    <script>
        // Flow mapping for component interactions
        const flowMap = {
            'phone': ['flow1', 'flow8'],
            'twilio': ['flow1', 'flow2', 'flow7', 'flow8'],
            'elevenlabs': ['flow2', 'flow3', 'flow6', 'flow7'],
            'system-prompt': ['flow0'],
            'claude': ['flow0', 'flow3', 'flow4', 'flow5', 'flow6'],
            'knowledge-base': ['flow4', 'flow5']
        };
        
        // Tooltip messages with detailed descriptions
        const tooltips = {
            'phone': "User's smartphone initiating voice call",
            'twilio': "Twilio handles telephony and WebRTC connections",
            'elevenlabs': "ElevenLabs hosts the voice agent with integrated STT/TTS capabilities, handling audio processing and speech synthesis",
            'system-prompt': "System prompt defines LLM behavior, personality, and instructions",
            'claude': "Claude 4 Sonnet processes natural language, generates intelligent responses, and exchanges text directly with the voice agent",
            'knowledge-base': "Vector database with RAG for contextual information retrieval"
        };
        
        // Animation sequence
        const flowSequence = ['flow0', 'flow1', 'flow2', 'flow3', 'flow4', 'flow5', 'flow6', 'flow7', 'flow8'];
        let animationIndex = 0;
        let animationInterval;
        
        // Get DOM elements
        const components = document.querySelectorAll('.component');
        const flowLines = document.querySelectorAll('.flow-line');
        const tooltip = document.getElementById('tooltip');
        
        // Add event listeners to components
        components.forEach(component => {
            // Hover effects
            component.addEventListener('mouseenter', (e) => {
                showTooltip(e, component.id);
            });
            
            component.addEventListener('mousemove', (e) => {
                moveTooltip(e);
            });
            
            component.addEventListener('mouseleave', () => {
                hideTooltip();
            });
            
            // Click highlighting
            component.addEventListener('click', () => {
                highlightFlows(component.id);
            });
        });
        
        // Tooltip functions
        function showTooltip(event, componentId) {
            tooltip.textContent = tooltips[componentId];
            tooltip.style.display = 'block';
            positionTooltip(event);
        }
        
        function moveTooltip(event) {
            positionTooltip(event);
        }
        
        function positionTooltip(event) {
            const tooltipRect = tooltip.getBoundingClientRect();
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;
            
            let left = event.pageX - (tooltipRect.width / 2);
            let top = event.pageY - tooltipRect.height - 15; // 15px above cursor
            
            // Keep tooltip within viewport bounds
            if (left < 10) left = 10;
            if (left + tooltipRect.width > viewportWidth - 10) left = viewportWidth - tooltipRect.width - 10;
            if (top < 10) top = event.pageY + 15; // Show below cursor if no room above
            
            tooltip.style.left = left + 'px';
            tooltip.style.top = top + 'px';
        }
        
        function hideTooltip() {
            tooltip.style.display = 'none';
        }
        
        // Flow highlighting
        function highlightFlows(componentId) {
            // Clear all active flows
            flowLines.forEach(line => line.classList.remove('active'));
            
            // Highlight flows connected to this component
            if (flowMap[componentId]) {
                flowMap[componentId].forEach(flowId => {
                    const flowElement = document.getElementById(flowId);
                    if (flowElement) {
                        flowElement.classList.add('active');
                    }
                });
            }
        }
        
        // Auto-animation
        function startAnimation() {
            animationInterval = setInterval(() => {
                // Clear all active flows
                flowLines.forEach(line => line.classList.remove('active'));
                
                // Activate current flow
                const currentFlow = document.getElementById(flowSequence[animationIndex]);
                if (currentFlow) {
                    currentFlow.classList.add('active');
                }
                
                // Move to next flow
                animationIndex = (animationIndex + 1) % flowSequence.length;
            }, 1000);
        }
        
        // Start animation after 2 seconds
        setTimeout(startAnimation, 2000);
        
        // Pause animation on component interaction, resume after 5 seconds
        let pauseTimeout;
        components.forEach(component => {
            component.addEventListener('click', () => {
                clearInterval(animationInterval);
                clearTimeout(pauseTimeout);
                pauseTimeout = setTimeout(startAnimation, 5000);
            });
        });
        
        // Responsive SVG sizing
        function adjustDiagramSize() {
            const svg = document.getElementById('architecture-diagram');
            const container = document.querySelector('.diagram-container');
            const containerWidth = container.offsetWidth;
            const maxWidth = Math.min(containerWidth - 40, 1200);
            svg.style.width = maxWidth + 'px';
            svg.style.height = (maxWidth * 0.75) + 'px';
        }
        
        // Adjust on load and resize
        window.addEventListener('load', adjustDiagramSize);
        window.addEventListener('resize', adjustDiagramSize);
    </script>
</body>
</html>